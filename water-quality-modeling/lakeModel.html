

<!DOCTYPE html>


<html lang="en" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

    <title>5. Lake Model &#8212; Water Quality Modeling</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=ac02cc09edc035673794" rel="stylesheet" />
<link href="../_static/styles/bootstrap.css?digest=ac02cc09edc035673794" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=ac02cc09edc035673794" rel="stylesheet" />

  
  <link href="../_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=ac02cc09edc035673794" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" href="../_static/styles/sphinx-book-theme.css?digest=14f4ca6b54d191a8c7657f6c759bf11a5fb86285" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=ac02cc09edc035673794" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=ac02cc09edc035673794" />
  <script src="../_static/vendor/fontawesome/6.1.2/js/all.min.js?digest=ac02cc09edc035673794"></script>

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?digest=5a5c038af52cf7bc1a1ec88eea08e6366ee68824"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'water-quality-modeling/lakeModel';</script>
    <link rel="canonical" href="https://Gakkykun.github.io/water-quality-modeling/water-quality-modeling/lakeModel.html" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Installation" href="installation.html" />
    <link rel="prev" title="4. IWA River Water Quality Model" href="IWA.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <div id="pst-scroll-pixel-helper"></div>

  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>
    Back to top
  </button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search..."
         aria-label="Search..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
    </nav>
  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
  

<a class="navbar-brand logo" href="../index.html">
  
  
  
  
    
    
      
    
    
    <img src="../_static/logo.png" class="logo__image only-light" alt="Logo image"/>
    <script>document.write(`<img src="../_static/logo.png" class="logo__image only-dark" alt="Logo image"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item"><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Chapters</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="fortranBasics.html">1. Fortran basics</a></li>
<li class="toctree-l1"><a class="reference internal" href="differentialEquation.html">2. Differential Equation</a></li>
<li class="toctree-l1"><a class="reference internal" href="streeterPhelps.html">3. Streeter Phelps Model</a></li>
<li class="toctree-l1"><a class="reference internal" href="IWA.html">4. IWA River Water Quality Model</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">5. Lake Model</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Appendices</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="bibliography.html">Bibliography</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-launch-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Launch interactive content">
    <i class="fas fa-rocket"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://mybinder.org/v2/gh/Gakkykun/water-quality-modeling/master?urlpath=tree/water-quality-modeling/lakeModel.md" target="_blank"
   class="btn btn-sm dropdown-item"
   title="Launch onBinder"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  
    <img src="../_static/images/logo_binder.svg">
  </span>
<span class="btn__text-container">Binder</span>
</a>
</li>
      
      
      
      
      <li><a href="https://colab.research.google.com/github/Gakkykun/water-quality-modeling/blob/master/water-quality-modeling/lakeModel.md" target="_blank"
   class="btn btn-sm dropdown-item"
   title="Launch onColab"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  
    <img src="../_static/images/logo_colab.png">
  </span>
<span class="btn__text-container">Colab</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/Gakkykun/water-quality-modeling" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/Gakkykun/water-quality-modeling/edit/main/water-quality-modeling/lakeModel.md" target="_blank"
   class="btn btn-sm btn-source-edit-button dropdown-item"
   title="Suggest edit"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-pencil-alt"></i>
  </span>
<span class="btn__text-container">Suggest edit</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/Gakkykun/water-quality-modeling/issues/new?title=Issue%20on%20page%20%2Fwater-quality-modeling/lakeModel.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../_sources/water-quality-modeling/lakeModel.ipynb" target="_blank"
   class="btn btn-sm btn-download-notebook-button dropdown-item"
   title="Download notebook file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-code"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li><a href="../_sources/water-quality-modeling/lakeModel.md" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.md</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>


<script>
document.write(`
  <button class="btn btn-sm navbar-btn theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch nav-link" data-mode="light"><i class="fa-solid fa-sun fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="dark"><i class="fa-solid fa-moon fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="auto"><i class="fa-solid fa-circle-half-stroke fa-lg"></i></span>
  </button>
`);
</script>

<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Lake Model</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#background">5.1. Background</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#implementation">5.2. Implementation</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="lake-model">
<h1><span class="section-number">5. </span>Lake Model<a class="headerlink" href="#lake-model" title="Permalink to this heading">#</a></h1>
<section id="background">
<h2><span class="section-number">5.1. </span>Background<a class="headerlink" href="#background" title="Permalink to this heading">#</a></h2>
<p>In this section, we will see vertical one-dimentional ecological model, in which advection and dispersion differential equations are applied. Advection and dispersion terms included in all of mass balance equations for water quality items of interest are summarized as <span class="math notranslate nohighlight">\(F(X)\)</span>, where <span class="math notranslate nohighlight">\(X\)</span> is a water quality item. Let’s see how each term of <span class="math notranslate nohighlight">\(F(X)\)</span> is derived. Symbols that appear in equations are listed in tables. For advections in the horizontal and vertical directions, we describe them as:</p>
<div class="math notranslate nohighlight">
\[
u_{in}(Bdy)X_{in}-u_{out}(Bdy)X
\]</div>
<div class="math notranslate nohighlight">
\[
VX\vert_{y}A-VX\vert_{y+dy}A
\]</div>
<p>We can use Taylor series expansion: <span class="math notranslate nohighlight">\(X\vert_{y+dy} = X\vert_{y} + \frac{\partial X}{\partial y}dy\)</span> and the vertical advection term is going to be: <span class="math notranslate nohighlight">\(-VA\frac{\partial X}{\partial y}dy\)</span>. We describe a diffusion term, introducing <span class="math notranslate nohighlight">\(J\)</span> as a diffusion flux, which is <span class="math notranslate nohighlight">\((\alpha_c + D_c)\frac{\partial X}{\partial y}\)</span>:</p>
<div class="math notranslate nohighlight">
\[
AJ\vert_{y} - AJ\vert_{y} 
\]</div>
<p>Again, we use Taylor series expansion and the above term is going to be <span class="math notranslate nohighlight">\(A\frac{\partial}{\partial y}((\alpha_c + D_c)\frac{\partial X}{\partial y})\partial y\)</span>. Summing the three terms, we finally get:</p>
<div class="math notranslate nohighlight">
\[
Bdy(u_{in}X_{in}-u_{out}X) - VA\frac{\partial X}{\partial y}\partial y + A\frac{\partial}{\partial y}((\alpha_c + D_c)\frac{\partial X}{\partial y})\partial y
\]</div>
<p>Divided by <span class="math notranslate nohighlight">\(A\partial y\)</span>, the above equation can be rearranged as:</p>
<div class="math notranslate nohighlight">
\[
F(X) = \frac{B}{A}(u_{in}X_{in}-u_{out}X)-\frac{1}{A}\frac{\partial VAX}{\partial y} +\frac{(\alpha_c + D_c)}{A}\frac{\partial}{\partial y}(A\frac{\partial X}{\partial y})
\]</div>
<table class="table">
<thead>
<tr class="row-odd"><th class="head"><p>Symbol</p></th>
<th class="head"><p>Parameter</p></th>
<th class="head"><p>Input values</p></th>
<th class="head"><p>Unit</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><span class="math notranslate nohighlight">\(A\)</span></p></td>
<td><p>Upper surface area of each layer</p></td>
<td><p>Depending on the depth</p></td>
<td><p><span class="math notranslate nohighlight">\(m^{2}\)</span></p></td>
</tr>
<tr class="row-odd"><td><p><span class="math notranslate nohighlight">\(B\)</span></p></td>
<td><p>Width of each layer</p></td>
<td><p><span class="math notranslate nohighlight">\(800.0\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(m\)</span></p></td>
</tr>
<tr class="row-even"><td><p><span class="math notranslate nohighlight">\(X_{in}\)</span></p></td>
<td><p>Influent concentration</p></td>
<td><p>From monitoring data</p></td>
<td><p><span class="math notranslate nohighlight">\(mg/L\)</span></p></td>
</tr>
<tr class="row-odd"><td><p><span class="math notranslate nohighlight">\(u_{in}\)</span></p></td>
<td><p>Inlet velocity</p></td>
<td><p>Calculated from monitoring data</p></td>
<td><p><span class="math notranslate nohighlight">\(m/d\)</span></p></td>
</tr>
<tr class="row-even"><td><p><span class="math notranslate nohighlight">\(u_{out}\)</span></p></td>
<td><p>Outlet velocity</p></td>
<td><p>Calculated from monitoring data</p></td>
<td><p><span class="math notranslate nohighlight">\(m/d\)</span></p></td>
</tr>
<tr class="row-odd"><td><p><span class="math notranslate nohighlight">\(V\)</span></p></td>
<td><p>Vertical velocity</p></td>
<td><p>Calculated from monitoring data</p></td>
<td><p><span class="math notranslate nohighlight">\(m/d\)</span></p></td>
</tr>
<tr class="row-even"><td><p><span class="math notranslate nohighlight">\(\alpha_c\)</span></p></td>
<td><p>Eddy diffusion coefficient</p></td>
<td><p><span class="math notranslate nohighlight">\(9 \times 10^{-4}\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(m^2/d\)</span></p></td>
</tr>
<tr class="row-odd"><td><p><span class="math notranslate nohighlight">\(D_c\)</span></p></td>
<td><p>Molecular diffusion coefficient</p></td>
<td><p><span class="math notranslate nohighlight">\(9 \times 10^{-5}\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(m^2/d\)</span></p></td>
</tr>
</tbody>
</table>
<p>Vertical velocities are calculated by:</p>
<div class="math notranslate nohighlight">
\[
V_{j,j+1} = \frac{A_{j-1,j}V_{j-1,j} - B_j\Delta y (u_{i,j} - u_{o,j})}{A_{j,j+1}}
\]</div>
<p>Horizontal velocities are estimated by:</p>
<div class="math notranslate nohighlight">
\[
u_{i,j} = Q_i U (\frac{y-y_{in}}{\delta_{in}})
\]</div>
<div class="math notranslate nohighlight">
\[
u_{o,j} = Q_o U (\frac{y-y_{out}}{\delta_{out}})
\]</div>
<p>where, <span class="math notranslate nohighlight">\(Q_i\)</span> and <span class="math notranslate nohighlight">\(Q_o\)</span> are flow rates of inflow and outflow to the reservoir, respectively. <span class="math notranslate nohighlight">\(y\)</span>, <span class="math notranslate nohighlight">\(y_{in}\)</span>, and <span class="math notranslate nohighlight">\(y_{out}\)</span> are vertical positions relative to the reservoir bottom for a specific layer, inflow and outflow, respectively. <span class="math notranslate nohighlight">\(\delta_{in}\)</span> and <span class="math notranslate nohighlight">\(\delta_{out}\)</span> are intrusion and withdrawal layer thickness. A function, <span class="math notranslate nohighlight">\(U(\psi)\)</span>, is given as the following depending on <span class="math notranslate nohighlight">\(\xi\)</span>. When <span class="math notranslate nohighlight">\(\xi\)</span> is smaller than <span class="math notranslate nohighlight">\(0.5\)</span>, <span class="math notranslate nohighlight">\(U(\psi)\)</span> is given by:</p>
<div class="math notranslate nohighlight">
\[
U(\xi) = \frac{e^{-\frac{1}{2}(\frac{\xi}{3.92})^2}}{\int_{-\frac{1}{2}}^{\frac{1}{2}} {B\left\lbrace y(\xi_1)\right\rbrace }e^{-\frac{1}{2}(\frac{\xi}{3.92})^2}d\xi_1}
\]</div>
<p>Otherwise,</p>
<div class="math notranslate nohighlight">
\[
U(\xi) = 0
\]</div>
<p><span class="math notranslate nohighlight">\(\delta_{in}\)</span> and <span class="math notranslate nohighlight">\(\delta_{out}\)</span> are estimated by:</p>
<div class="math notranslate nohighlight">
\[
\delta_{in} = F_i^{-\frac{1}{2}}(\frac{Q_{in}}{B_i \sqrt{\varepsilon_i g}})^{\frac{1}{2}}
\]</div>
<div class="math notranslate nohighlight">
\[
\delta_{out} = G^{-\frac{1}{3}}(\frac{Q_{out}}{\theta \sqrt{\varepsilon_o g}})^{\frac{1}{3}}
\]</div>
<p>where, <span class="math notranslate nohighlight">\(F\)</span> and <span class="math notranslate nohighlight">\(G\)</span> are internal Froude numbers and empirically set at <span class="math notranslate nohighlight">\(0.25\)</span> and <span class="math notranslate nohighlight">\(0.134\)</span>. <span class="math notranslate nohighlight">\(\varepsilon\)</span> is a density gradient and can be calculated by <span class="math notranslate nohighlight">\(-\frac{1}{\rho}\frac{d\rho}{dy}\)</span>. <span class="math notranslate nohighlight">\(\theta\)</span> is an angle of the outflow mouth.</p>
<p>Now, let’s consider a term regarding bio-chemical reactions. Growth and endogenous respiration rates of algae as well as decomposition rates of TOC and oxygen consumption rates in the sediment are listed below.</p>
<div class="math notranslate nohighlight">
\[
G_{\gamma} = G_{\gamma max}\theta^{T-20}\frac{TP}{K_P +TP}\left\lbrace \frac{\phi}{I_s}exp(1-\frac{\phi}{I_s})\right\rbrace
\]</div>
<div class="math notranslate nohighlight">
\[
R_{\gamma} = R_{\gamma max}\theta^{T-20}
\]</div>
<div class="math notranslate nohighlight">
\[
K_{c} = K_{c20}\theta^{T-20}
\]</div>
<div class="math notranslate nohighlight">
\[
K_{b} = K_{b20}\theta^{T-20}
\]</div>
<table class="table">
<thead>
<tr class="row-odd"><th class="head"><p>Symbol</p></th>
<th class="head"><p>Parameter</p></th>
<th class="head"><p>Input values</p></th>
<th class="head"><p>Unit</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><span class="math notranslate nohighlight">\(G_{\gamma max}\)</span></p></td>
<td><p>Maximum specific growth rate of algae at 20<span class="math notranslate nohighlight">\(^\circ C\)</span></p></td>
<td><p>2.0</p></td>
<td><p><span class="math notranslate nohighlight">\(1/d\)</span></p></td>
</tr>
<tr class="row-odd"><td><p><span class="math notranslate nohighlight">\(R_{\gamma max}\)</span></p></td>
<td><p>Endogenous respiration rate of algae at 20<span class="math notranslate nohighlight">\(^\circ C\)</span></p></td>
<td><p>0.09</p></td>
<td><p><span class="math notranslate nohighlight">\(1/d\)</span></p></td>
</tr>
<tr class="row-even"><td><p><span class="math notranslate nohighlight">\(K_{C20}\)</span></p></td>
<td><p>Decomposition rate constant of TOC at 20<span class="math notranslate nohighlight">\(^\circ C\)</span></p></td>
<td><p>0.01</p></td>
<td><p><span class="math notranslate nohighlight">\(1/d\)</span></p></td>
</tr>
<tr class="row-odd"><td><p><span class="math notranslate nohighlight">\(\theta\)</span></p></td>
<td><p>Temperature coefficient</p></td>
<td><p>1.07</p></td>
<td><p>-</p></td>
</tr>
<tr class="row-even"><td><p><span class="math notranslate nohighlight">\(K_{P}\)</span></p></td>
<td><p>Half saturation coefficient of algae</p></td>
<td><p>26.0</p></td>
<td><p><span class="math notranslate nohighlight">\(mg\:P/m^{3}\)</span></p></td>
</tr>
<tr class="row-odd"><td><p><span class="math notranslate nohighlight">\(I_{S}\)</span></p></td>
<td><p>Optimum light intensity</p></td>
<td><p>300.0</p></td>
<td><p><span class="math notranslate nohighlight">\(kcal/m^{2}/d\)</span></p></td>
</tr>
<tr class="row-even"><td><p><span class="math notranslate nohighlight">\(\beta\)</span></p></td>
<td><p>Adsorption coefficient at water surface</p></td>
<td><p>0.5</p></td>
<td><p>-</p></td>
</tr>
<tr class="row-odd"><td><p><span class="math notranslate nohighlight">\(\alpha_{r}\)</span></p></td>
<td><p>Reflection coefficient at water surface</p></td>
<td><p><span class="math notranslate nohighlight">\(0.06\)</span></p></td>
<td><p>-</p></td>
</tr>
<tr class="row-even"><td><p><span class="math notranslate nohighlight">\(\phi_{n}\)</span></p></td>
<td><p>Light intensity</p></td>
<td><p>From monitoring data</p></td>
<td><p><span class="math notranslate nohighlight">\(kcal/m^2/d\)</span></p></td>
</tr>
<tr class="row-odd"><td><p><span class="math notranslate nohighlight">\(\eta\)</span></p></td>
<td><p>Light absorption coefficient</p></td>
<td><p><span class="math notranslate nohighlight">\(0.4\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(1/m\)</span></p></td>
</tr>
<tr class="row-even"><td><p><span class="math notranslate nohighlight">\(y_{0}\)</span></p></td>
<td><p>Elevation from the lake bottom</p></td>
<td><p><span class="math notranslate nohighlight">\(80\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(m\)</span></p></td>
</tr>
</tbody>
</table>
<p>Mass balance equations for Chl.a and SS</p>
<div class="math notranslate nohighlight">
\[
\frac{\partial Chl.a}{\partial t} = (G_\gamma - R_\gamma)Chl.a + W_0 \frac{\partial Chl.a}{\partial y} + F(Chl.a) 
\]</div>
<div class="math notranslate nohighlight">
\[
\frac{\partial SS}{\partial t} = W_0 \frac{\partial SS}{\partial y} + F(SS) 
\]</div>
<p>Derivation of the sedimentation term can be done as the following with Taylor series expansion of <span class="math notranslate nohighlight">\(X\vert_{y+dy}\)</span>, which is <span class="math notranslate nohighlight">\(X\vert_{y} + \frac{\partial X}{\partial y}dy\)</span>:</p>
<div class="math notranslate nohighlight">
\[
\frac{1}{A\partial y}((-W_0)AX\vert_{y} - (-W_0)AX\vert_{y+dy})) = \frac{1}{A \partial y} W_0 A\frac{\partial X}{\partial y}\partial y
\]</div>
<table class="table">
<thead>
<tr class="row-odd"><th class="head"><p>Symbol</p></th>
<th class="head"><p>Parameter</p></th>
<th class="head"><p>Input values</p></th>
<th class="head"><p>Unit</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><span class="math notranslate nohighlight">\(W_0\)</span></p></td>
<td><p>Sedimentation rate</p></td>
<td><p>0.4</p></td>
<td><p><span class="math notranslate nohighlight">\(m/d\)</span></p></td>
</tr>
<tr class="row-odd"><td><p><span class="math notranslate nohighlight">\(\sigma_{C\gamma}\)</span></p></td>
<td><p>Ratio of biological release of TOC from algae</p></td>
<td><p><span class="math notranslate nohighlight">\(4.8 \times 10^{-2}\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(mg\:TOC/mg\:Chl.a\)</span></p></td>
</tr>
<tr class="row-even"><td><p><span class="math notranslate nohighlight">\(\sigma_{P\gamma}\)</span></p></td>
<td><p>Coefficient of biological utilization of TP from algae</p></td>
<td><p><span class="math notranslate nohighlight">\(1.25\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(mg\:P/mg\:Chl.a\)</span></p></td>
</tr>
<tr class="row-odd"><td><p><span class="math notranslate nohighlight">\(\sigma_{N\gamma}\)</span></p></td>
<td><p>Coefficient of biological utilization of TN from algae</p></td>
<td><p><span class="math notranslate nohighlight">\(17.0\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(mg\:N/mg\:Chl.a\)</span></p></td>
</tr>
<tr class="row-even"><td><p><span class="math notranslate nohighlight">\(\beta_{\gamma}\)</span></p></td>
<td><p>Yield coefficient of TN and TP</p></td>
<td><p><span class="math notranslate nohighlight">\(0.6\)</span></p></td>
<td><p>-</p></td>
</tr>
<tr class="row-odd"><td><p><span class="math notranslate nohighlight">\(\sigma_{O\gamma}\)</span></p></td>
<td><p>Coefficient of biological production of <span class="math notranslate nohighlight">\(O_2\)</span> for algae</p></td>
<td><p><span class="math notranslate nohighlight">\(0.13\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(mg\:O_2/mg\:Chl.a\)</span></p></td>
</tr>
<tr class="row-even"><td><p><span class="math notranslate nohighlight">\(\sigma_{OC}\)</span></p></td>
<td><p>Oxygen demand exerted by TOC decomposition</p></td>
<td><p><span class="math notranslate nohighlight">\(2.7\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(mg\:O_2/mg\:TOC\)</span></p></td>
</tr>
</tbody>
</table>
<p>Mass balance equations for TOC, Tp, TN and DO are given as follows:</p>
<div class="math notranslate nohighlight">
\[
\frac{\partial TOC}{\partial t} = \sigma_{C\gamma}R_\gamma Chl.a - K_C TOC + F(TOC) 
\]</div>
<div class="math notranslate nohighlight">
\[
\frac{\partial TP}{\partial t} = \sigma_{P\gamma}(-G_\gamma +\beta_\gamma R_\gamma)Chl.a + F(TP) 
\]</div>
<div class="math notranslate nohighlight">
\[
\frac{\partial TN}{\partial t} = \sigma_{N\gamma}(-G_\gamma + \beta_\gamma R_\gamma)Chl.a + F(TN)
\]</div>
<div class="math notranslate nohighlight">
\[
\frac{\partial DO}{\partial t} = \sigma_{O\gamma}(G_\gamma - R_\gamma)Chl.a - \sigma_{OC} K_C TOC - \frac{K_b}{A}\frac{\partial A}{\partial y} + F(DO)
\]</div>
<p>Derivation of the third term in the right-hand side of the DO mass balance equation can be done as the following with Taylor series expansion of <span class="math notranslate nohighlight">\(A\vert_{y+dy}\)</span>, which is <span class="math notranslate nohighlight">\(A\vert_{y} + \frac{\partial A}{\partial y}dy\)</span>:</p>
<div class="math notranslate nohighlight">
\[
-\frac{1}{A\partial y}K_b(A\vert_{y+dy} - A\vert_{y}) = -\frac{K_b}{A\partial y}\frac{\partial A}{\partial y}\partial y
\]</div>
<p>As we saw in the Streeter-Phelps model, a flux of oxygen dissolution from the atmosphere is described as:</p>
<div class="math notranslate nohighlight">
\[\begin{split}
 \begin{split}
    J&amp; = -D_m\frac{C_{DO}}{dz} \\
    &amp; = D_m\frac{C_{DO}^* - C_{DO}}{\delta} \\
    &amp; = \frac{D_m}{\delta}(C_{DO}^* - C_{DO})
 \end{split}
\end{split}\]</div>
<p>In case that a wind velocity, <span class="math notranslate nohighlight">\(V_w\)</span>, is larger and equal to <span class="math notranslate nohighlight">\(V_{w0}\)</span>, which is a reference wind velocity:</p>
<div class="math notranslate nohighlight">
\[
\frac{\delta}{\delta_0} = (\frac{V_w}{V_w0})^{-2} 
\]</div>
<p>Otherwise,</p>
<div class="math notranslate nohighlight">
\[
\frac{\delta}{\delta_0} = 1 
\]</div>
<p>where, <span class="math notranslate nohighlight">\(\delta_0 = 440\:\mu m \)</span> and <span class="math notranslate nohighlight">\(V_{w0} = 2\:m/s\)</span>.</p>
<p>Energy balance equation is given:</p>
<div class="math notranslate nohighlight">
\[
\frac{\partial T}{\partial t} = \frac{B}{A}(u_{in}T_{in}-u_{out}T)-\frac{1}{A}\frac{\partial VAX}{\partial y} + \frac{(\alpha_T + D_T)}{A}\frac{\partial}{\partial y}(A\frac{\partial T}{\partial y}) - \frac{1}{\rho AC}\frac{\partial (A\phi)}{\partial y}
\]</div>
<table class="table">
<thead>
<tr class="row-odd"><th class="head"><p>Symbol</p></th>
<th class="head"><p>Parameter</p></th>
<th class="head"><p>Input values</p></th>
<th class="head"><p>Unit</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><span class="math notranslate nohighlight">\(T_{in}\)</span></p></td>
<td><p>Influent temperature</p></td>
<td><p>From monitoring data</p></td>
<td><p><span class="math notranslate nohighlight">\(mg/L\)</span></p></td>
</tr>
<tr class="row-odd"><td><p><span class="math notranslate nohighlight">\(\alpha_{T}\)</span></p></td>
<td><p>Thermal eddy diffusion coefficient</p></td>
<td><p><span class="math notranslate nohighlight">\(9 \times 10^{-4}\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(m^2/d\)</span></p></td>
</tr>
<tr class="row-even"><td><p><span class="math notranslate nohighlight">\(D_{T}\)</span></p></td>
<td><p>Heat diffusion coefficient</p></td>
<td><p><span class="math notranslate nohighlight">\(9 \times 10^{-5}\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(m^2/d\)</span></p></td>
</tr>
<tr class="row-odd"><td><p><span class="math notranslate nohighlight">\(\rho\)</span></p></td>
<td><p>Water density</p></td>
<td><p><span class="math notranslate nohighlight">\(1.0\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(t/m^3\)</span></p></td>
</tr>
<tr class="row-even"><td><p><span class="math notranslate nohighlight">\(C\)</span></p></td>
<td><p>Specific heat</p></td>
<td><p><span class="math notranslate nohighlight">\(1.0\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(kcal/kg/^\circ C \)</span></p></td>
</tr>
</tbody>
</table>
<p>Derivation of the last term can be done as the following with Taylor series expansion of <span class="math notranslate nohighlight">\((A\phi)\vert_{y+dy}\)</span>, which is <span class="math notranslate nohighlight">\((A\phi)\vert_{y} + \frac{\partial (A\phi)}{\partial y}\partial y\)</span>:
Let’s look at how to derive the last term:</p>
<div class="math notranslate nohighlight">
\[
\frac{1}{A\partial y}\frac{1}{\rho C}((A\phi)\vert_y - (A\phi)\vert_{y+dy})) = \frac{1}{\rho AC}\frac{\partial (A\phi)}{\partial y}
\]</div>
</section>
<section id="implementation">
<h2><span class="section-number">5.2. </span>Implementation<a class="headerlink" href="#implementation" title="Permalink to this heading">#</a></h2>
<p>Explicit time advance is used as a numerical scheme. Time-step and space step are set at <span class="math notranslate nohighlight">\(0.2\:d\)</span> and <span class="math notranslate nohighlight">\(2\:m\)</span>, respectively. The followings are inputs:</p>
<ul class="simple">
<li><p>Irradiation(<span class="math notranslate nohighlight">\(\phi_n\)</span>)</p></li>
<li><p>Wind velocity (<span class="math notranslate nohighlight">\(V_w\)</span>)</p></li>
<li><p>Influent and effluent flow rates (<span class="math notranslate nohighlight">\(Q_i\)</span> and <span class="math notranslate nohighlight">\(Q_o\)</span>)</p></li>
<li><p>Water temperature (<span class="math notranslate nohighlight">\(T_{in}\)</span>) and quality (<span class="math notranslate nohighlight">\(X_{in}\)</span>) of influent flow</p></li>
</ul>
<div class="highlight-Fortran notranslate"><div class="highlight"><pre><span></span><span class="c">! Monitoring data - daily average</span>
<span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nb">mod</span><span class="p">(</span><span class="n">j</span><span class="p">,</span><span class="w"> </span><span class="n">count_day</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">   </span><span class="n">day</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">day</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span>
<span class="w">    </span>
<span class="w">   </span><span class="k">read</span><span class="w"> </span><span class="p">(</span><span class="mi">99</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="n">MonitoringDataDaily</span><span class="p">(</span><span class="n">day</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">),</span><span class="w"> </span><span class="n">MonitoringDataDaily</span><span class="p">(</span><span class="n">day</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">),</span><span class="w"> </span><span class="n">MonitoringDataDaily</span><span class="p">(</span><span class="n">day</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">),</span><span class="w"> </span><span class="n">MonitoringDataDaily</span><span class="p">(</span><span class="n">day</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">),</span><span class="w"> </span><span class="n">MonitoringDataDaily</span><span class="p">(</span><span class="n">day</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="p">)</span>
<span class="w">    </span>
<span class="w">   </span><span class="n">Q_in</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MonitoringDataDaily</span><span class="p">(</span><span class="n">day</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="w">              </span><span class="c">! Inlet flow rate [m^3/d]</span>
<span class="w">   </span><span class="n">Q_out</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MonitoringDataDaily</span><span class="p">(</span><span class="n">day</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="w">             </span><span class="c">! Outlet flow rate [m^3/d]         </span>
<span class="w">   </span><span class="n">phi_n</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MonitoringDataDaily</span><span class="p">(</span><span class="n">day</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span><span class="w">             </span><span class="c">! Light intensity [kcal/m^3/d]</span>
<span class="w">   </span><span class="n">Vw</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MonitoringDataDaily</span><span class="p">(</span><span class="n">day</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span><span class="w">                </span><span class="c">! Wind velocity [m/s]</span>
<span class="w">   </span><span class="n">month_c</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MonitoringDataDaily</span><span class="p">(</span><span class="n">day</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="p">)</span>
<span class="w">    </span>
<span class="w">   </span><span class="c">! Monitoring data for inlet - montyly average</span>
<span class="w">   </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">month</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nb">int</span><span class="p">(</span><span class="n">month_c</span><span class="p">))</span><span class="w"> </span><span class="k">then</span>
<span class="k">     read</span><span class="w"> </span><span class="p">(</span><span class="mi">98</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="n">MonitoringDataMonth</span><span class="p">(</span><span class="n">month</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">),</span><span class="w">  </span><span class="n">MonitoringDataMonth</span><span class="p">(</span><span class="n">month</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">),</span><span class="w"> </span><span class="n">MonitoringDataMonth</span><span class="p">(</span><span class="n">month</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">),</span><span class="w"> </span><span class="n">MonitoringDataMonth</span><span class="p">(</span><span class="n">month</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">),</span><span class="w"> </span><span class="n">MonitoringDataMonth</span><span class="p">(</span><span class="n">month</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="p">),</span><span class="w"> </span><span class="n">MonitoringDataMonth</span><span class="p">(</span><span class="n">month</span><span class="p">,</span><span class="w"> </span><span class="mi">6</span><span class="p">),</span><span class="w"> </span><span class="n">MonitoringDataMonth</span><span class="p">(</span><span class="n">month</span><span class="p">,</span><span class="w"> </span><span class="mi">7</span><span class="p">)</span>
<span class="w">    </span>
<span class="w">     </span><span class="n">T_in</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MonitoringDataMonth</span><span class="p">(</span><span class="n">month</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w">             </span><span class="c">! Inlet water temperature </span>
<span class="w">     </span><span class="n">Chla_in</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MonitoringDataMonth</span><span class="p">(</span><span class="n">month</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span><span class="w">          </span><span class="c">! Inlet chlorophyl concentration</span>
<span class="w">     </span><span class="n">TOC_in</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MonitoringDataMonth</span><span class="p">(</span><span class="n">month</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">)</span><span class="w">           </span><span class="c">! Inlet TOC concentration</span>
<span class="w">     </span><span class="n">TP_in</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MonitoringDataMonth</span><span class="p">(</span><span class="n">month</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">)</span><span class="w">            </span><span class="c">! Inlet TP concentration</span>
<span class="w">     </span><span class="n">TN_in</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MonitoringDataMonth</span><span class="p">(</span><span class="n">month</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="p">)</span><span class="w">            </span><span class="c">! Inlet TN concentration</span>
<span class="w">     </span><span class="n">DO_in</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MonitoringDataMonth</span><span class="p">(</span><span class="n">month</span><span class="p">,</span><span class="w"> </span><span class="mi">6</span><span class="p">)</span><span class="w">            </span><span class="c">! Inlet DO concentration</span>
<span class="w">     </span><span class="n">SS_in</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MonitoringDataMonth</span><span class="p">(</span><span class="n">month</span><span class="p">,</span><span class="w"> </span><span class="mi">7</span><span class="p">)</span><span class="w">            </span><span class="c">! Inlet SS concentration</span>
<span class="w">  </span><span class="k">else     </span>
<span class="k">    </span><span class="n">month</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">month</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span>
<span class="w">    </span>
<span class="w">    </span><span class="k">read</span><span class="w"> </span><span class="p">(</span><span class="mi">98</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="n">MonitoringDataMonth</span><span class="p">(</span><span class="n">month</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">),</span><span class="w"> </span><span class="n">MonitoringDataMonth</span><span class="p">(</span><span class="n">month</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">),</span><span class="w"> </span><span class="n">MonitoringDataMonth</span><span class="p">(</span><span class="n">month</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">),</span><span class="w"> </span><span class="n">MonitoringDataMonth</span><span class="p">(</span><span class="n">month</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">),</span><span class="w"> </span><span class="n">MonitoringDataMonth</span><span class="p">(</span><span class="n">month</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="p">),</span><span class="w"> </span><span class="n">MonitoringDataMonth</span><span class="p">(</span><span class="n">month</span><span class="p">,</span><span class="w"> </span><span class="mi">6</span><span class="p">),</span><span class="w"> </span><span class="n">MonitoringDataMonth</span><span class="p">(</span><span class="n">month</span><span class="p">,</span><span class="w"> </span><span class="mi">7</span><span class="p">)</span>
<span class="w">    </span>
<span class="w">    </span><span class="n">T_in</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MonitoringDataMonth</span><span class="p">(</span><span class="n">month</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w">          </span>
<span class="w">    </span><span class="n">Chla_in</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MonitoringDataMonth</span><span class="p">(</span><span class="n">month</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span><span class="w">         </span>
<span class="w">    </span><span class="n">TOC_in</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MonitoringDataMonth</span><span class="p">(</span><span class="n">month</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">)</span><span class="w">           </span>
<span class="w">    </span><span class="n">TP_in</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MonitoringDataMonth</span><span class="p">(</span><span class="n">month</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">)</span><span class="w">            </span>
<span class="w">    </span><span class="n">TN_in</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MonitoringDataMonth</span><span class="p">(</span><span class="n">month</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="p">)</span><span class="w">            </span>
<span class="w">    </span><span class="n">DO_in</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MonitoringDataMonth</span><span class="p">(</span><span class="n">month</span><span class="p">,</span><span class="w"> </span><span class="mi">6</span><span class="p">)</span><span class="w">            </span>
<span class="w">    </span><span class="n">SS_in</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MonitoringDataMonth</span><span class="p">(</span><span class="n">month</span><span class="p">,</span><span class="w"> </span><span class="mi">7</span><span class="p">)</span><span class="w">            </span>
<span class="w">    </span>
<span class="w">  </span><span class="k">end if</span>
<span class="k"> end if</span>
</pre></div>
</div>
<div class="highlight-Fortran notranslate"><div class="highlight"><pre><span></span><span class="n">cDO</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cDO</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="n">j</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">dt</span><span class="o">*</span><span class="n">gamma_oy</span><span class="o">*</span><span class="p">(</span><span class="n">Gy</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">Ry</span><span class="p">)</span><span class="o">*</span><span class="n">cChla</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">dt</span><span class="o">*</span><span class="n">gamma_oc</span><span class="o">*</span><span class="n">kc</span><span class="o">*</span><span class="n">cTOC</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="n">j</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">dt</span><span class="o">*</span><span class="n">kb</span><span class="o">/</span><span class="n">A</span><span class="o">*</span><span class="n">dAdy</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">dt</span><span class="o">*</span><span class="n">B</span><span class="o">/</span><span class="n">A</span><span class="o">*</span><span class="p">(</span><span class="n">u_in</span><span class="o">*</span><span class="n">DO_in</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">u_out</span><span class="o">*</span><span class="n">cDO</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="n">j</span><span class="p">))</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">V</span><span class="o">*</span><span class="n">dt</span><span class="o">/</span><span class="n">dz</span><span class="o">/</span><span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="n">cDO</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">j</span><span class="p">)</span><span class="o">-</span><span class="w"> </span><span class="n">cDO</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">j</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="n">alpha</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">diff</span><span class="p">)</span><span class="o">*</span><span class="n">dt</span><span class="o">/</span><span class="n">dz</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="n">cDO</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">j</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">2</span><span class="o">*</span><span class="n">cDO</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">cDO</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">j</span><span class="p">))</span>
<span class="w">    </span>
<span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">cDO</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">    </span><span class="n">cDO</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span>
<span class="w"> </span><span class="k">endif</span>
<span class="k">    </span>
<span class="k"> </span><span class="n">cDO</span><span class="p">(</span><span class="n">N</span><span class="p">,</span><span class="w"> </span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">=</span><span class="w"> </span><span class="n">cDO</span><span class="p">(</span><span class="n">N</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">dt</span><span class="o">*</span><span class="n">aeration</span><span class="p">(</span><span class="n">Vw</span><span class="p">,</span><span class="w"> </span><span class="n">cDO</span><span class="p">(</span><span class="n">N</span><span class="p">,</span><span class="n">j</span><span class="p">),</span><span class="w"> </span><span class="n">dz</span><span class="p">,</span><span class="w"> </span><span class="n">t</span><span class="p">(</span><span class="n">N</span><span class="p">,</span><span class="n">j</span><span class="p">))</span>
<span class="w">    </span>
</pre></div>
</div>
<div class="highlight-Fortran notranslate"><div class="highlight"><pre><span></span><span class="k">function </span><span class="n">aeration</span><span class="w"> </span><span class="p">(</span><span class="n">Vw</span><span class="p">,</span><span class="w"> </span><span class="n">cDO</span><span class="p">,</span><span class="w"> </span><span class="n">dz</span><span class="p">,</span><span class="w"> </span><span class="n">wt</span><span class="p">)</span><span class="w"> </span><span class="k">result</span><span class="p">(</span><span class="n">retval</span><span class="p">)</span>
<span class="w">  </span><span class="kt">real</span><span class="p">(</span><span class="n">real64</span><span class="p">),</span><span class="w"> </span><span class="k">intent</span><span class="w"> </span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">Vw</span><span class="p">,</span><span class="w"> </span><span class="n">cDO</span><span class="p">,</span><span class="w"> </span><span class="n">dz</span><span class="p">,</span><span class="w"> </span><span class="n">wt</span>
<span class="w">  </span><span class="kt">real</span><span class="p">(</span><span class="n">real64</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">Vw0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">2.0</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w">                  </span>
<span class="w">  </span><span class="n">Lx0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">44</span><span class="mf">0.0</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w">                   </span>
<span class="w">  </span><span class="n">Lx</span><span class="p">,</span><span class="w"> </span><span class="n">DO_sat</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">mdo</span>
<span class="w">    </span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">Vw</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="n">Vw0</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">    </span><span class="n">Lx</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Lx0</span><span class="o">*</span><span class="p">(</span><span class="n">Vw</span><span class="o">/</span><span class="n">Vw0</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">)</span>
<span class="w">  </span><span class="k">else </span>
<span class="k">    </span><span class="n">Lx</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Lx0</span>
<span class="w">  </span><span class="k">end if </span>
<span class="k">    </span>
<span class="k">  </span><span class="n">DO_sat</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="mf">4.652</span><span class="o">-</span><span class="mf">0.41022</span><span class="o">*</span><span class="n">wt</span><span class="o">+</span><span class="mf">0.007991</span><span class="o">*</span><span class="n">wt</span><span class="o">**</span><span class="mi">2</span><span class="o">-</span><span class="mf">0.000077774</span><span class="o">*</span><span class="n">wt</span><span class="o">**</span><span class="mi">3</span>
<span class="w">  </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.024716</span><span class="o">*</span><span class="p">(</span><span class="n">wt</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">2</span><span class="mf">0.0</span><span class="p">)</span>
<span class="w">    </span>
<span class="w">  </span><span class="c">! molecular diffusion coefficients - m2/s </span>
<span class="w">  </span><span class="n">mdo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="o">*</span><span class="nb">exp</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">/</span><span class="mi">1000000000</span><span class="w">           </span>
<span class="w">    </span>
<span class="w">  </span><span class="n">retval</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mdo</span><span class="o">/</span><span class="p">(</span><span class="n">Lx</span><span class="o">*</span><span class="n">dz</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">DO_sat</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">cDO</span><span class="p">)</span>
<span class="w">    </span>
<span class="w"> </span><span class="k">end function </span><span class="n">aeration</span>
<span class="w">    </span>
</pre></div>
</div>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./water-quality-modeling"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer">
                  <!-- Previous / next buttons -->
<div class="prev-next-area">
    <a class="left-prev"
       href="IWA.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title"><span class="section-number">4. </span>IWA River Water Quality Model</p>
      </div>
    </a>
    <a class="right-next"
       href="installation.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Installation</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">

  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#background">5.1. Background</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#implementation">5.2. Implementation</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Yoshihiko Inagaki
</p>

  </div>
  
  <div class="footer-item">
    
  <p class="copyright">
    
      © Copyright 2023.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/bootstrap.js?digest=ac02cc09edc035673794"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=ac02cc09edc035673794"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>